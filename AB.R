## Data extracted manually from https://covid19stats.alberta.ca/
## Last updated April 3rd
## From Plotly plots 

library(dplyr)
library(readr)
library(zoo)

negative_date <- c("2020-01-24", "2020-01-27", "2020-01-28", "2020-01-30", "2020-02-03", "2020-02-05", "2020-02-06", "2020-02-07", "2020-02-10", "2020-02-11", "2020-02-13", "2020-02-14", "2020-02-15", "2020-02-16", "2020-02-17", "2020-02-18", "2020-02-19", "2020-02-20", "2020-02-22", "2020-02-23", "2020-02-24", "2020-02-25", "2020-02-26", "2020-02-27", "2020-02-28", "2020-02-29", "2020-03-01", "2020-03-02", "2020-03-03", "2020-03-04", "2020-03-05", "2020-03-06", "2020-03-07", "2020-03-08", "2020-03-09", "2020-03-10", "2020-03-11", "2020-03-12", "2020-03-13", "2020-03-14", "2020-03-15", "2020-03-16", "2020-03-17", "2020-03-18", "2020-03-19", "2020-03-20", "2020-03-21", "2020-03-22", "2020-03-23", "2020-03-24", "2020-03-25", "2020-03-26", "2020-03-27", "2020-03-28", "2020-03-29", "2020-03-30", "2020-03-31", "2020-04-01", "2020-04-02", "2020-04-03")
negative_count <- c(1, 1, 8, 3, 7, 1, 3, 1, 5, 12, 9, 28, 6, 4, 7, 6, 8, 6, 9, 1, 3, 12, 16, 15, 15, 30, 27, 26, 27, 71, 55, 61, 274, 440, 718, 965, 961, 1144, 1418, 1589, 1781, 1305, 2135, 2858, 2772, 3388, 3534, 2612, 2706, 3127, 1836, 1115, 3579, 2116, 1866, 2614, 4454, 3600, 3944, 341)
negativedat <- data.frame(Date = as.Date(negative_date), new_negative_people=negative_count)

positive_date <- c("2020-03-06", "2020-03-07", "2020-03-08", "2020-03-09", "2020-03-10", "2020-03-11", "2020-03-12", "2020-03-13", "2020-03-14", "2020-03-15", "2020-03-16", "2020-03-17", "2020-03-18", "2020-03-19", "2020-03-20", "2020-03-21", "2020-03-22", "2020-03-23", "2020-03-24", "2020-03-25", "2020-03-26", "2020-03-27", "2020-03-28", "2020-03-29", "2020-03-30", "2020-03-31", "2020-04-01", "2020-04-02", "2020-04-03")
positive_count <- c(1, 2, 3, 6, 6, 5, 2, 8, 19, 9, 20, 8, 27, 31, 31, 26, 29, 36, 49, 51, 31, 68, 36, 18, 28, 107, 83, 85, 7)
positivedat <- data.frame(Date = as.Date(positive_date), new_positive_people=positive_count)

## Infection type 
Type_date <- c("2020-03-06", "2020-03-07", "2020-03-08", "2020-03-09", "2020-03-10", "2020-03-11", "2020-03-12", "2020-03-13", "2020-03-14", "2020-03-15", "2020-03-16", "2020-03-17", "2020-03-18", "2020-03-19", "2020-03-20", "2020-03-21", "2020-03-22", "2020-03-23", "2020-03-24", "2020-03-25", "2020-03-26", "2020-03-27", "2020-03-28", "2020-03-29", "2020-03-30", "2020-03-31", "2020-04-01", "2020-04-02", "2020-04-03")
Close_contact <- c(0, 0, 0, 1, 1, 1, 3, 3, 11, 18, 29, 37, 50, 61, 81, 95, 110, 126, 152, 187, 219, 255, 286, 296, 316, 366, 393, 402, 402)
Suspected_community <- c(0, 0, 0, 0, 0, 0, 0, 0, 4, 5, 5, 6, 9, 12, 18, 22, 25, 29, 39, 44, 48, 61, 66, 72, 80, 104, 115, 119, 120)
Travel <- c(1, 1, 1, 6, 15, 22, 22, 30, 37, 39, 52, 58, 70, 84, 102, 116, 137, 161, 188, 214, 230, 260, 278, 290, 310, 360, 382, 387, 387)
Type_dat <- data.frame(Date=as.Date(Type_date),Close_contact,Suspected_community,Travel)

## Zone (subregion) currently not using

Calgary_date <- c("2020-03-06", "2020-03-09", "2020-03-10", "2020-03-11", "2020-03-12", "2020-03-13", "2020-03-14", "2020-03-15", "2020-03-16", "2020-03-17", "2020-03-18", "2020-03-19", "2020-03-20", "2020-03-21", "2020-03-22", "2020-03-23", "2020-03-24", "2020-03-25", "2020-03-26", "2020-03-27", "2020-03-28", "2020-03-29", "2020-03-30", "2020-03-31", "2020-04-01", "2020-04-02", "2020-04-03")
Calgary <- c(1, 3, 6, 5, 2, 8, 13, 9, 15, 6, 22, 13, 25, 27, 30, 26, 38, 48, 40, 40, 33, 20, 24, 87, 60, 68, 1)

Central_date <- c("2020-03-11", "2020-03-16", "2020-03-17", "2020-03-20", "2020-03-21", "2020-03-22", "2020-03-23", "2020-03-24", "2020-03-25", "2020-03-26", "2020-03-27", "2020-03-29", "2020-03-30", "2020-03-31", "2020-04-01", "2020-04-02")
Central <- c(1, 1, 1, 2, 2, 6, 13, 8, 2, 4, 8, 1, 3, 4, 2, 4)

Edmonton_date <- c("2020-03-09", "2020-03-10", "2020-03-11", "2020-03-14", "2020-03-15", "2020-03-16", "2020-03-17", "2020-03-18", "2020-03-19", "2020-03-20", "2020-03-21", "2020-03-22", "2020-03-23", "2020-03-24", "2020-03-25", "2020-03-26", "2020-03-27", "2020-03-28", "2020-03-29", "2020-03-30", "2020-03-31", "2020-04-01", "2020-04-02", "2020-04-03")
Edmonton <- c(3, 3, 1, 6, 1, 5, 7, 3, 8, 14, 5, 6, 13, 14, 14, 6, 20, 17, 8, 20, 36, 35, 13, 5)

North_date <- c("2020-03-16", "2020-03-17", "2020-03-18", "2020-03-19", "2020-03-20", "2020-03-21", "2020-03-22", "2020-03-24", "2020-03-25", "2020-03-26", "2020-03-27", "2020-03-28", "2020-03-30", "2020-03-31", "2020-04-02")
North <- c(2, 1, 1, 7, 3, 2, 2, 2, 2, 4, 16, 4, 3, 3, 5)

South_date <- c("2020-03-16", "2020-03-18", "2020-03-19", "2020-03-20", "2020-03-21", "2020-03-22", "2020-03-24", "2020-03-25", "2020-04-01", "2020-04-02", "2020-04-03")
South <- c(1, 2, 1, 2, 1, 1, 2, 2, 1, 2, 1)


## Way back machine to get back daily updated numbers


front_date <- c("2020-03-20","2020-03-21","2020-03-22","2020-03-24","2020-03-25","2020-03-27","2020-03-28","2020-03-29","2020-03-30","2020-03-31","2020-04-01","2020-04-02","2020-04-03")
# Cases <- c(195,226,259,358,419,542,621,661,690,754,871,968,1075)
cum_Hosp <- c(10,11,18,19,24,34,38,41,47,49,62,67,75)
cum_ICU <- c(5,6,7,7,8,11,12,14,17,17,20,21,24)
People_tested <- c(20160,23742, 26999,32776,35508,38215,41691,44097,46057,48692,NA,NA,60508)

Frontdat <- data.frame(Date = as.Date(front_date)
    # , Cases
    , Hospitalizations
    , ICU
    , People_tested
)


## CTV hospitalization and ICU prevalence 
## https://edmonton.ctvnews.ca/infographics-covid-19-in-alberta-by-the-numbers-1.4874153

preval_Hosp <- c(3,5,5,6,5,10,11,18,18,19,20,21,23,26,28,28,26,29,32,39)
preval_ICU <- c(2,2,2,3,2,5,6,7,7,7,8,10,10,11,12,11,11,13,14,15)
CTVprevalencedat <- data.frame(Date = as.Date(as.Date("2020-03-15"):as.Date("2020-04-03"))
    , preval_Hosp
    , preval_ICU 
)

## CTV tracker for recovery data using WBM
CTVtrackerdate <- as.Date(as.Date("2020-03-20"):as.Date("2020-04-03"))
recovery <- c(2,2,2,3,3,3,27,33,53,73,94,120,142,174,196)
recoverydat <- data.frame(Date=CTVtrackerdate,cum_recovery=recovery)

## Code for combining all the data
rawdat <- (read_csv("COVID-19_test.csv")
    %>% filter(Province == "AB")
    # %>% select(Date,confirmed_positive,deceased,total_testing)
)

## making a date dataframe

today <- Sys.Date()
today <- as.Date("2020-04-03") ## Use updated date for now

dd_date <- data.frame(Date = as.Date(as.Date("2020-01-24"):today))

ddcombo <- (left_join(dd_date,rawdat)
    %>% select(Date,cum_positive=confirmed_positive,cum_death=deceased,cum_testing=total_testing)
    %>% left_join(.,recoverydat)
    %>% left_join(.,positivedat) 
    %>% left_join(.,negativedat)
    %>% left_join(.,Frontdat)
    %>% left_join(.,CTVprevalencedat)
    %>% mutate(new_positive = diff(c(NA,cum_positive))
        , new_positive_people = ifelse(is.na(new_positive_people),0,new_positive_people)
        , new_negative_people = ifelse(is.na(new_negative_people),0,new_negative_people)
        , calc_cum_positive_people = cumsum(new_positive_people)
        , calc_cum_negative_people = cumsum(new_negative_people)
        , calc_people = calc_cum_positive_people + calc_cum_negative_people
        )
)

write.csv(ddcombo,"ABcombo.csv")
